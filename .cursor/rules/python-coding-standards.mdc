---
description: Python coding standards and best practices for this project
globs: ["**/*.py"]
alwaysApply: false
---

# Python Coding Standards

## Type Annotations

- ALWAYS add typing annotations to each function or class
- Include return types when necessary
- Use `List`, `Dict`, `Optional` from typing for Python 3.8 compatibility (mLinux 6)
- Can use `list`, `dict`, `|` for Python 3.10+ only (mLinux 7, Ubuntu)

## Docstrings

- Add descriptive docstrings to all Python functions and classes
- Use PEP 257 convention for docstring formatting
- Update existing docstrings if needed

## Comments

- Keep any comments that exist in a file
- Do not remove existing comments when making changes

## Code Style

- Use Ruff for code style consistency
- Run `ruff check src tests` before committing
- Run `ruff format src tests` for formatting
- Run `mypy src --ignore-missing-imports` for type checking

### Common Ruff Issues

| Code | Issue | Fix |
|------|-------|-----|
| F401 | Unused imports | Remove or add to `__all__` |
| E501 | Line too long | Break into multiple lines |
| B904 | Use `raise ... from err` | Add `from err` in except blocks |
| D401 | Docstrings should be imperative | Start with verb (e.g., "Return" not "Returns") |
| I001 | Import sorting | Run `ruff format` |

## Project Structure

- Clear project structure with separate directories for source code, tests, docs, and config
- Modular design with distinct files for models, services, controllers, and utilities
- Create `__init__.py` files in all Python package directories

## Configuration Models

- Use dataclasses for configuration (no pydantic - not available on gateway)
- Implement `from_dict()` class methods for JSON deserialization
- No external dependencies beyond stdlib
- Python 3.8 compatible type hints for mlinux-6
- Support nested configuration structures
- Provide default values for optional fields

Example:
```python
from dataclasses import dataclass, field
from typing import Any, Dict, List, Optional

@dataclass
class MyConfig:
    name: str = ""
    enabled: bool = True
    items: List[str] = field(default_factory=list)
    
    @classmethod
    def from_dict(cls, data: Dict[str, Any]) -> "MyConfig":
        return cls(
            name=data.get("name", ""),
            enabled=data.get("enabled", True),
            items=data.get("items", []),
        )
```

## Error Handling

- Robust error handling and logging, including context capture
- Use structured logging with syslog for gateway deployments

## CI/CD with GitHub Actions

```yaml
name: CI
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.10', '3.11', '3.12']
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - run: pip install -r requirements.txt
      - run: ruff check src tests
      - run: ruff format --check src tests
      - run: mypy src --ignore-missing-imports
      - run: pytest tests/ -v --cov=src
```

## Security - Sensitive Information

**NEVER commit personal or session-specific information to the repository:**

- Gateway IP addresses from user's session context
- Usernames and passwords from user's session context  
- API keys, tokens, or credentials
- Personal file paths or hostnames

In documentation and examples, use generic placeholders:
- `{IP}` or `192.168.1.100` for IP addresses
- `{username}` or `admin` for usernames
- `{password}` or `yourpassword` for passwords
- `{app_name}`, `{version}`, `{ID}` for variable values
